<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8" />
  <title>3 en Ratlla PRO</title>
  <style>
    :root {
      --bg: #0f172a;
      --card: rgba(255,255,255,0.12);
      --accent: #38bdf8;
      --win: #22c55e;
      --lose: #ef4444;
      --text: #e5e7eb;
      --muted: #94a3b8;
    }
    * { box-sizing: border-box; font-family: system-ui, -apple-system, BlinkMacSystemFont; }
    body {
      margin: 0; min-height: 100vh;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: var(--text);
      display: flex; align-items: center; justify-content: center;
    }
    .app {
      width: 100%; max-width: 420px;
      background: var(--card);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border-radius: 24px; padding: 20px;
      box-shadow:
        0 25px 60px rgba(0,0,0,.45),
        inset 0 1px 0 rgba(255,255,255,.25);
      border: 1px solid rgba(255,255,255,.25);
      animation: fadeIn .6s ease;
    }
    @keyframes fadeIn { from { opacity:0; transform: translateY(10px);} to {opacity:1;} }
    h1 { margin: 0 0 10px; text-align: center; }
    .menu, .game { display: none; }
    .menu.active, .game.active { display: block; }
    button {
      width: 100%; padding: 12px; margin: 8px 0;
      border-radius: 14px; border: none;
      background: linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.7));
      color: #020617;
      font-size: 16px; font-weight: 600; cursor: pointer;
      box-shadow:
        0 8px 25px rgba(0,0,0,.35),
        inset 0 1px 0 rgba(255,255,255,.6);
      transition: transform .15s ease, box-shadow .15s ease;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow:
        0 14px 30px rgba(0,0,0,.45),
        inset 0 1px 0 rgba(255,255,255,.7);
    }
    button.secondary {
      background: rgba(255,255,255,0.15);
      color: var(--text);
      backdrop-filter: blur(10px);
    }
    button:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(56,189,248,.4); }
    button.secondary { background: #1e293b; color: var(--text); }
    .board {
      display: grid; grid-template-columns: repeat(3, 1fr);
      gap: 10px; margin-top: 20px;
    }
    .cell {
      aspect-ratio: 1;
      background: rgba(255,255,255,0.08);
      backdrop-filter: blur(10px);
      border-radius: 18px;
      display: flex; align-items: center; justify-content: center;
      font-size: 48px; cursor: pointer;
      transition: background .2s ease, transform .15s ease, box-shadow .15s ease;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.25);
    }
    .cell:hover {
      background: rgba(255,255,255,0.18);
      transform: scale(1.07);
      box-shadow: 0 8px 25px rgba(0,0,0,.35);
    }
    .cell.win {
      background: rgba(34,197,94,.85);
      color:#022c22;
      animation: pop .3s ease;
    }
    .cell:hover { background:#020617cc; transform: scale(1.05); }
    .cell.win { background: var(--win); color:#022c22; animation: pop .3s ease; }
    @keyframes pop { 50% { transform: scale(1.15);} }
    .status { text-align: center; margin-top: 10px; color: var(--muted); }
    .score { display:flex; justify-content: space-around; margin-top:10px; font-size:14px; }
  </style>
</head>
<body>
  <div class="app">
    <h1>ðŸŽ® 3 en Ratlla PRO</h1>

    <div class="menu active" id="menu">
      <p style="text-align:center; color:var(--muted)">Mode de joc</p>
      <button onclick="startGame('pvp')">ðŸ‘¥ Jugador vs Jugador</button>
      <button onclick="startGame('ai')">ðŸ¤– Jugador vs IA</button>
    </div>

    <div class="game" id="game">
      <div class="board" id="board"></div>
      <div class="status" id="status"></div>
      <button class="secondary" onclick="resetGame()">ðŸ”„ Tornar al menÃº</button>
    </div>
  </div>

  <script>
    const menu = document.getElementById('menu');
    const game = document.getElementById('game');
    const boardEl = document.getElementById('board');
    const statusEl = document.getElementById('status');

    let board, current, mode;

    function startGame(m) {
      mode = m;
      board = Array(9).fill(null);
      current = 'X';
      menu.classList.remove('active');
      game.classList.add('active');
      drawBoard();
      updateStatus();
    }

    function resetGame() {
      game.classList.remove('active');
      menu.classList.add('active');
    }

    function drawBoard() {
      boardEl.innerHTML = '';
      board.forEach((cell, i) => {
        const div = document.createElement('div');
        div.className = 'cell';
        div.textContent = cell ?? '';
        div.onclick = () => play(i);
        boardEl.appendChild(div);
      });
    }

    function play(i) {
      if (board[i] || checkWinner()) return;
      board[i] = current;
      current = current === 'X' ? 'O' : 'X';
      drawBoard();
      updateStatus();

      if (mode === 'ai' && current === 'O' && !checkWinner()) {
        setTimeout(aiMove, 400);
      }
    }

    function aiMove() {
      const bestMove = minimax(board, 'O').index;
      play(bestMove);
    }

    function minimax(newBoard, player) {
      const avail = newBoard.map((v,i)=>v?null:i).filter(v=>v!==null);
      const winner = checkWinner();
      if (winner === 'X') return { score: -10 };
      if (winner === 'O') return { score: 10 };
      if (avail.length === 0) return { score: 0 };

      const moves = [];
      for (const i of avail) {
        const move = {};
        move.index = i;
        newBoard[i] = player;
        const result = minimax(newBoard, player === 'O' ? 'X' : 'O');
        move.score = result.score;
        newBoard[i] = null;
        moves.push(move);
      }

      let bestMove;
      if (player === 'O') {
        let bestScore = -Infinity;
        for (const m of moves) {
          if (m.score > bestScore) { bestScore = m.score; bestMove = m; }
        }
      } else {
        let bestScore = Infinity;
        for (const m of moves) {
          if (m.score < bestScore) { bestScore = m.score; bestMove = m; }
        }
      }
      return bestMove;
    }

    function updateStatus() {
      const winner = checkWinner();
      if (winner) statusEl.textContent = `ðŸ† Guanya ${winner}`;
      else if (!board.includes(null)) statusEl.textContent = 'ðŸ¤ Empat';
      else statusEl.textContent = `Torn de ${current}`;
    }

    function checkWinner() {
      const wins = [
        [0,1,2],[3,4,5],[6,7,8],
        [0,3,6],[1,4,7],[2,5,8],
        [0,4,8],[2,4,6]
      ];
      for (const [a,b,c] of wins) {
        if (board[a] && board[a] === board[b] && board[a] === board[c]) {
          return board[a];
        }
      }
      return null;
    }
  // ðŸŽµ SOUNDS
    const clickSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3');
    const winSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3');

    // ðŸ§© SCORE (localStorage)
    let score = JSON.parse(localStorage.getItem('score')) || { X: 0, O: 0 };

    function updateScoreUI() {
      let scoreEl = document.getElementById('score');
      if (!scoreEl) {
        scoreEl = document.createElement('div');
        scoreEl.id = 'score';
        scoreEl.className = 'score';
        game.prepend(scoreEl);
      }
      scoreEl.innerHTML = `âŒ X: ${score.X} <span>â­• O: ${score.O}</span>`;
      localStorage.setItem('score', JSON.stringify(score));
    }

    function play(i) {
      if (board[i] || checkWinner()) return;
      clickSound.currentTime = 0; clickSound.play();
      board[i] = current;
      current = current === 'X' ? 'O' : 'X';
      drawBoard();
      updateStatus();

      const winner = checkWinner();
      if (winner) {
        winSound.play();
        score[winner]++;
        updateScoreUI();
      }

      if (mode === 'ai' && current === 'O' && !checkWinner()) {
        setTimeout(aiMove, 400);
      }
    }

    function startGame(m) {
      mode = m;
      board = Array(9).fill(null);
      current = 'X';
      menu.classList.remove('active');
      game.classList.add('active');
      drawBoard();
      updateStatus();
      updateScoreUI();
    }

  </script>
</body>
</html>
